<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Now Playing</title>

<style>
body {
  margin: 0;
  background: #111;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
}

/* ===== UI ===== */
.menu {
  position: fixed;
  top: 12px;
  right: 12px;
  font-size: 22px;
  z-index: 20;
  cursor: pointer;
}

/* ===== STAGE ===== */
.stage {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ===== VIDEO ===== */
.video {
  position: absolute;
  width: 220px;
  height: 124px;
  opacity: 0.25;
  transition: all 0.4s ease;
  z-index: 1;
}

.video iframe {
  width: 100%;
  height: 100%;
  border-radius: 8px;
}

/* CDが前面のときは動画を小さく */
.stage.cd-front .video {
  width: 180px;
  height: 101px;
  opacity: 0.15;
}

/* CD mini 時のみ動画を大きく（←今回の追加） */
.stage.cd-mini .video {
  width: 340px;
  height: 191px;
  opacity: 0.35;
}

/* ===== CD ===== */
.cd {
  width: 260px;
  height: 260px;
  border-radius: 50%;
  background: url("cd.jpeg") center / cover no-repeat;
  animation: spin 10s linear infinite;
  animation-play-state: paused;
  z-index: 2;
  transition: all 0.45s ease;
  cursor: pointer;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* CD mini（左上） */
.cd.mini {
  position: fixed;
  top: 8px;          /* ← 前版より少し上 */
  left: 8px;
  width: 84px;       /* ← 1回りだけ小さく */
  height: 84px;
}

/* ===== CONTROLS ===== */
.controls {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  width: 320px;
  text-align: center;
  z-index: 10;
}

button {
  border: none;
  border-radius: 50%;
  padding: 10px 14px;
  margin: 0 6px;
  cursor: pointer;
}

.seekbar {
  width: 100%;
}

.time {
  font-size: 12px;
  color: #aaa;
  display: flex;
  justify-content: space-between;
}
</style>
</head>

<body>

<div class="menu">☰</div>

<div class="stage cd-front" id="stage">
  <div class="video" id="video">
    <div id="player"></div>
  </div>
  <div class="cd" id="cd"></div>
</div>

<div class="controls">
  <button onclick="prev()">⏮</button>
  <button id="playBtn" onclick="toggle()">▶</button>
  <button onclick="next()">⏭</button>

  <input type="range" id="seek" class="seekbar" min="0" max="100" value="0">

  <div class="time">
    <span id="cur">0:00</span>
    <span id="dur">0:00</span>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const album = [
  { id: "HCoTcCMLRsM", title: "Q", artist: "REBEL" },
  { id: "p8iNb7sTNiY", title: "ロストワンの号哭", artist: "REBEL" },
  { id: "uC44M7_srjg", title: "DOGLAND", artist: "REBEL" }
];

let idx = 0;
let yt;
let playing = false;
let seeking = false;

const cd = document.getElementById("cd");
const stage = document.getElementById("stage");
const seek = document.getElementById("seek");
const playBtn = document.getElementById("playBtn");

function onYouTubeIframeAPIReady() {
  yt = new YT.Player("player", {
    videoId: album[0].id,
    playerVars: { playsinline: 1, controls: 0, rel: 0 },
    events: { onReady, onStateChange }
  });
}

function onReady() {
  yt.setVolume(0);
  loop();
}

function onStateChange(e) {
  if (e.data === YT.PlayerState.PLAYING) {
    cd.style.animationPlayState = "running";
    setTimeout(() => yt.setVolume(100), 300);
  }
  if (e.data === YT.PlayerState.PAUSED) {
    cd.style.animationPlayState = "paused";
  }
  if (e.data === YT.PlayerState.ENDED) next();
}

/* ===== PLAY ===== */
function toggle() {
  if (playing) {
    yt.pauseVideo();
    playBtn.textContent = "▶";
  } else {
    yt.playVideo();
    playBtn.textContent = "⏸";
  }
  playing = !playing;
}

/* ===== TRACK ===== */
function load() {
  yt.loadVideoById(album[idx].id);
  playing = false;
  playBtn.textContent = "▶";
}

function next() {
  idx = (idx + 1) % album.length;
  load();
}

function prev() {
  idx = (idx - 1 + album.length) % album.length;
  load();
}

/* ===== SEEK ===== */
seek.oninput = () => seeking = true;
seek.onchange = () => {
  yt.seekTo((seek.value / 100) * yt.getDuration(), true);
  seeking = false;
};

function loop() {
  if (yt && yt.getCurrentTime) {
    const d = yt.getDuration() || 0;
    const c = yt.getCurrentTime();
    if (!seeking && d) seek.value = (c / d) * 100;
    document.getElementById("cur").textContent = fmt(c);
    document.getElementById("dur").textContent = fmt(d);
  }
  requestAnimationFrame(loop);
}

function fmt(s) {
  const m = Math.floor(s / 60);
  const ss = Math.floor(s % 60).toString().padStart(2, "0");
  return `${m}:${ss}`;
}

/* ===== CD TAP ===== */
cd.onclick = () => {
  cd.classList.toggle("mini");
  stage.classList.toggle("cd-mini");
  stage.classList.toggle("cd-front");
};
</script>

</body>
</html>
