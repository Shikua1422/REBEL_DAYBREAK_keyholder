<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Now Playing</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  background: #111;
  color: #fff;
}

/* ===== ヘッダー ===== */
.header {
  position: fixed;
  top: 12px;
  right: 16px;
  z-index: 40;
}
.menu-btn {
  font-size: 26px;
  cursor: pointer;
}

/* ===== プレイリスト ===== */
.playlist {
  position: fixed;
  top: 0;
  right: -100%;
  width: 260px;
  height: 100%;
  background: #181818;
  padding: 20px;
  transition: right 0.35s ease;
  z-index: 35;
}
.playlist.open { right: 0; }
.track {
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
}
.track.active { background: #333; }
.track span {
  display: block;
  font-size: 12px;
  color: #aaa;
}

/* ===== メイン ===== */
.container {
  padding: 44px 15px 20px;
  text-align: center;
}

.stage {
  position: relative;
  width: 300px;
  height: 300px;
  margin: 20px auto;
}

/* ===== 動画 ===== */
.video {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 220px;
  height: 124px;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 1;
}
.stage.cd-mini .video {
  width: 360px;
  height: 202px;
}

/* ===== CD ===== */
.cd {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: url("cd.jpeg") center/cover no-repeat;
  animation: spin 10s linear infinite;
  animation-play-state: paused;
  cursor: pointer;
  z-index: 5;
  transition: all 0.45s ease;
}
.cd.mini {
  width: 58px;
  height: 58px;
  top: -50px;
  left: -22px;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

/* ===== 情報 ===== */
.title { font-size: 18px; margin-top: 10px; }
.artist { font-size: 14px; color: #aaa; }

/* ===== コントロール ===== */
.controls { margin-top: 18px; }

.control-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 22px;
}

/* モノクロボタン */
.ctrl-btn {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  color: #aaa;
  transition: color 0.2s, transform 0.2s;
}
.ctrl-btn:hover {
  color: #fff;
  transform: scale(1.05);
}
.ctrl-btn svg {
  width: 26px;
  height: 26px;
  fill: currentColor;
}

/* ===== 再生ボタン＋リング ===== */
.play-wrap {
  position: relative;
  width: 56px;
  height: 56px;
}

.play-btn {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: #000;
  border: 1px solid #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.play-btn svg {
  width: 22px;
  height: 22px;
  fill: #fff;
}

/* リング */
.play-ring {
  position: absolute;
  inset: -6px;
  display: none;
}
.playing .play-ring {
  display: block;
  animation:
    spin 2s linear infinite,
    ringColor 10s linear infinite;
}
.play-ring circle {
  fill: none;
  stroke-width: 3;
}

@keyframes ringColor {
  0%   { stroke: #fff; }
  20%  { stroke: red; }
  40%  { stroke: #7fffd4; }
  60%  { stroke: #1e90ff; }
  80%  { stroke: #9b59b6; }
  100% { stroke: #fff; }
}

/* ===== シークバー ===== */
.seekbar {
  width: 100%;
  margin-top: 16px;
  -webkit-appearance: none;
  background: transparent;
}
.seekbar::-webkit-slider-runnable-track {
  height: 4px;
  background: #444;
  border-radius: 2px;
}
.seekbar::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 12px;
  height: 12px;
  background: #fff;
  border-radius: 50%;
  margin-top: -4px;
}

.time {
  font-size: 12px;
  color: #aaa;
  display: flex;
  justify-content: space-between;
  margin-top: 4px;
}
</style>
</head>

<body>

<div class="header">
  <div class="menu-btn" onclick="toggleList()">☰</div>
</div>

<div class="playlist" id="playlist"></div>

<div class="container">
  <div class="stage">
    <div id="player" class="video"></div>
    <div id="cd" class="cd"></div>
  </div>

  <div class="title" id="title"></div>
  <div class="artist" id="artist"></div>

  <div class="controls">
    <div class="control-row">
      <!-- 戻し -->
      <button class="ctrl-btn" onclick="prev()">
        <svg viewBox="0 0 24 24"><path d="M18 5v14l-8.5-7zM6 5h3v14H6z"/></svg>
      </button>

      <!-- 再生 -->
      <div class="play-wrap" id="playWrap">
        <svg class="play-ring" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="46"/>
        </svg>
        <button class="play-btn" onclick="toggle()">
          <svg id="playIcon" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      </div>

      <!-- 送り -->
      <button class="ctrl-btn" onclick="next()">
        <svg viewBox="0 0 24 24"><path d="M6 5v14l8.5-7zM15 5h3v14h-3z"/></svg>
      </button>
    </div>

    <input type="range" id="seekbar" class="seekbar" min="0" max="100">
    <div class="time">
      <span id="current">0:00</span>
      <span id="duration">0:00</span>
    </div>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
const album = [
  { id: "HCoTcCMLRsM", title: "Q", artist: "REBEL" },
  { id: "p8iNb7sTNiY", title: "ロストワンの号哭", artist: "REBEL" },
  { id: "uC44M7_srjg", title: "DOGLAND", artist: "REBEL" }
];

let player, index = 0;
let playing = false, seeking = false;
let rotationTimer = null;
let cdMini = false;

const cd = document.getElementById("cd");
const stage = document.querySelector(".stage");
const playIcon = document.getElementById("playIcon");
const playWrap = document.getElementById("playWrap");
const seekbar = document.getElementById("seekbar");
const playlist = document.getElementById("playlist");

function onYouTubeIframeAPIReady() {
  player = new YT.Player("player", {
    videoId: album[0].id,
    playerVars: { playsinline: 1, controls: 0 },
    events: { onReady, onStateChange }
  });
}

function onReady() {
  player.setVolume(0);
  renderList();
  updateInfo();
  loop();
}

function onStateChange(e) {
  if (e.data === YT.PlayerState.PLAYING) startRotation();
  if (e.data === YT.PlayerState.ENDED) next();
}

function toggle() { playing ? pause() : play(); }

function play() {
  player.playVideo();
  playing = true;
  playWrap.classList.add("playing");
  playIcon.innerHTML = '<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>';
}

function pause() {
  player.pauseVideo();
  stopRotation();
  player.setVolume(0);
  playing = false;
  playWrap.classList.remove("playing");
  playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
}

/* 回転 */
function startRotation() {
  if (cd.style.animationPlayState === "running") return;
  cd.style.animationPlayState = "running";
  clearTimeout(rotationTimer);
  rotationTimer = setTimeout(() => player.setVolume(100), 300);
}
function stopRotation() {
  cd.style.animationPlayState = "paused";
  clearTimeout(rotationTimer);
}

/* CDタップ */
cd.onclick = () => {
  cdMini = !cdMini;
  cd.classList.toggle("mini", cdMini);
  stage.classList.toggle("cd-mini", cdMini);
};

/* シーク */
seekbar.oninput = () => seeking = true;
seekbar.onchange = () => {
  player.seekTo((seekbar.value / 100) * player.getDuration(), true);
  seeking = false;
};

function loop() {
  if (!player || seeking) return requestAnimationFrame(loop);

  const dur = player.getDuration();
  if (!dur) return requestAnimationFrame(loop);

  const cur = player.getCurrentTime();
  seekbar.value = (cur / dur) * 100;
  current.textContent = format(cur);
  duration.textContent = format(dur);

  requestAnimationFrame(loop);
}

/* 曲操作 */
function loadTrack(i) {
  index = i;
  stopRotation();
  player.setVolume(0);
  player.loadVideoById(album[index].id);
  updateInfo();
  renderList();
  playing = false;
  playWrap.classList.remove("playing");
  playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
}
function next() { loadTrack((index + 1) % album.length); }
function prev() { loadTrack((index - 1 + album.length) % album.length); }

/* プレイリスト */
function renderList() {
  playlist.innerHTML = "<h3>アルバム</h3>";
  album.forEach((t, i) => {
    const div = document.createElement("div");
    div.className = "track" + (i === index ? " active" : "");
    div.innerHTML = `${t.title}<span>${t.artist}</span>`;
    div.onclick = () => { loadTrack(i); toggleList(); };
    playlist.appendChild(div);
  });
}

function toggleList() {
  playlist.classList.toggle("open");
}

function updateInfo() {
  title.textContent = album[index].title;
  artist.textContent = album[index].artist;
}

function format(sec) {
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60).toString().padStart(2, "0");
  return `${m}:${s}`;
}
</script>

</body>
</html>
