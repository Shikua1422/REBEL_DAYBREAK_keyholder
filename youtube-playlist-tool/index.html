<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>YouTube Playlist → Albumコード生成</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  font-family: system-ui, -apple-system, sans-serif;
  background: #111;
  color: #fff;
  padding: 20px;
}
input, button, textarea, select {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  font-size: 14px;
}
button {
  background: #444;
  color: #fff;
  border: none;
  cursor: pointer;
}
.video-row {
  border-bottom: 1px solid #333;
  padding: 10px 0;
}
.row-flex {
  display: flex;
  gap: 6px;
}
textarea {
  height: 220px;
  background: #000;
  color: #0f0;
}
select {
  background: #222;
  color: #fff;
}
</style>
</head>
<body>

<h2>YouTube 再生リスト → Albumコード生成</h2>

<input id="playlistInput" placeholder="再生リストURL または ID" />
<button onclick="loadPlaylist()">動画ID取得</button>

<label style="display:block;margin:10px 0;">
  <input type="checkbox" id="bulkArtistToggle">
  artistが同じ場合のみ一括入力する
</label>
<input id="bulkArtistInput" placeholder="一括で設定する artist" disabled>

<div id="videoList"></div>

<button onclick="generateCode()">JSコード生成</button>
<textarea id="output"></textarea>

<script>
const API_KEY = "AIzaSyCO-5yTbTfXy-oNdW7lhFJADQsHtsWkPuE";

/* ===== 再生リストID抽出 ===== */
function extractPlaylistId(input) {
  try {
    if (input.includes("list=")) {
      return new URL(input).searchParams.get("list");
    }
  } catch (e) {}
  return input.trim();
}

/* ===== 再生リスト順で全件取得 ===== */
async function loadPlaylist() {
  const playlistId = extractPlaylistId(
    document.getElementById("playlistInput").value
  );

  const list = document.getElementById("videoList");
  list.innerHTML = "読み込み中…";

  let allItems = [];
  let pageToken = "";

  while (true) {
    const url =
      `https://www.googleapis.com/youtube/v3/playlistItems` +
      `?part=contentDetails` +
      `&playlistId=${playlistId}` +
      `&maxResults=50` +
      `&pageToken=${pageToken}` +
      `&key=${API_KEY}`;

    const res = await fetch(url);
    const data = await res.json();

    if (!data.items) {
      list.innerHTML = "取得に失敗しました（APIキーやURLを確認）";
      return;
    }

    allItems = allItems.concat(data.items);

    if (!data.nextPageToken) break;
    pageToken = data.nextPageToken;
  }

  list.innerHTML = "";

  allItems.forEach((item, index) => {
    const videoId = item.contentDetails.videoId;

    const div = document.createElement("div");
    div.className = "video-row";
    div.innerHTML = `
      <div>${index + 1}. id: <b>${videoId}</b></div>
      <div class="row-flex">
        <input placeholder="title" />
        <input placeholder="artist" />
      </div>
      <select>
        <option value="youtube">YouTube</option>
        <option value="nicovideo">niconico</option>
      </select>
    `;
    list.appendChild(div);
  });

  applyBulkArtist();
}

/* ===== artist一括入力 ===== */
const bulkToggle = document.getElementById("bulkArtistToggle");
const bulkInput  = document.getElementById("bulkArtistInput");

bulkToggle.addEventListener("change", () => {
  bulkInput.disabled = !bulkToggle.checked;
  applyBulkArtist();
});

bulkInput.addEventListener("input", applyBulkArtist);

function applyBulkArtist() {
  if (!bulkToggle.checked) return;

  const rows = document.querySelectorAll(".video-row");
  rows.forEach(row => {
    const artistInput = row.querySelectorAll("input")[1];
    if (!artistInput.value) {
      artistInput.value = bulkInput.value;
    }
  });
}

/* ===== JSコード生成 ===== */
function generateCode() {
  const rows = document.querySelectorAll(".video-row");
  const lines = [];

  rows.forEach(row => {
    const id = row.querySelector("b").textContent;
    const inputs = row.querySelectorAll("input");
    const select = row.querySelector("select");

    const title = inputs[0].value || "";
    const artist = inputs[1].value || "";
    const platform = select.value;

    lines.push(
      `  { id:"${id}", title:"${title}", artist:"${artist}", platform:"${platform}" }`
    );
  });

  const result =
`AlbumB: [
${lines.join(",\n")}
]`;

  document.getElementById("output").value = result;
}
</script>

</body>
</html>
