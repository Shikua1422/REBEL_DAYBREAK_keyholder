<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>YouTube Playlist â†’ Albumã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  font-family: system-ui, -apple-system, sans-serif;
  background: #111;
  color: #fff;
  padding: 20px;
}
input, button, textarea {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  font-size: 14px;
}
button {
  background: #444;
  color: #fff;
  border: none;
  cursor: pointer;
}
.video-row {
  border-bottom: 1px solid #333;
  padding: 8px 0;
}
.video-row input {
  width: calc(50% - 6px);
  display: inline-block;
}
textarea {
  height: 200px;
  background: #000;
  color: #0f0;
}
</style>
</head>
<body>

<h2>YouTube å†ç”Ÿãƒªã‚¹ãƒˆ â†’ Albumã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</h2>

<input id="playlistInput" placeholder="å†ç”Ÿãƒªã‚¹ãƒˆURL ã¾ãŸã¯ ID" />
<button onclick="loadPlaylist()">å‹•ç”»IDå–å¾—</button>

<label style="display:block;margin:10px 0;">
  <input type="checkbox" id="bulkArtistToggle" />
  artistã‚’ä¸€æ‹¬å…¥åŠ›ã™ã‚‹
</label>

<input
  id="bulkArtistInput"
  placeholder="ä¸€æ‹¬ã§è¨­å®šã™ã‚‹ artist"
  disabled
/>

<div id="videoList"></div>

<button onclick="generateCode()">JSã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</button>
<textarea id="output"></textarea>

<script>
const API_KEY = "AIzaSyCO-5yTbTfXy-oNdW7lhFJADQsHtsWkPuE";

function extractPlaylistId(input) {
  if (input.includes("list=")) {
    return new URL(input).searchParams.get("list");
  }
  return input;
}

async function loadPlaylist() {
  const playlistId = extractPlaylistId(
    document.getElementById("playlistInput").value
  );

  const list = document.getElementById("videoList");
  list.innerHTML = "èª­ã¿è¾¼ã¿ä¸­â€¦";

  let allItems = [];
  let pageToken = "";

  // ğŸ” å…¨ãƒšãƒ¼ã‚¸å–å¾—ï¼ˆé †ç•ªã¯APIãŒä¿è¨¼ï¼‰
  while (true) {
    const url =
      `https://www.googleapis.com/youtube/v3/playlistItems` +
      `?part=contentDetails` +
      `&playlistId=${playlistId}` +
      `&maxResults=50` +
      `&pageToken=${pageToken}` +
      `&key=${API_KEY}`;

    const res = await fetch(url);
    const data = await res.json();

    allItems = allItems.concat(data.items);

    if (!data.nextPageToken) break;
    pageToken = data.nextPageToken;
  }

  list.innerHTML = "";

  // ğŸ‘‰ å–å¾—é † = å†ç”Ÿãƒªã‚¹ãƒˆé †
  allItems.forEach((item, index) => {
    const videoId = item.contentDetails.videoId;

    const div = document.createElement("div");
    div.className = "video-row";
    div.innerHTML = `
      <div>${index + 1}. id: <b>${videoId}</b></div>
      <input placeholder="title" />
      <input placeholder="artist" />
    `;
    list.appendChild(div);
  });
}

function generateCode() {
  const rows = document.querySelectorAll(".video-row");
  const lines = [];

  rows.forEach(row => {
    const id = row.querySelector("b").textContent;
    const inputs = row.querySelectorAll("input");
    const title = inputs[0].value || "";
    const artist = inputs[1].value || "";

    lines.push(`  { id:"${id}", title:"${title}", artist:"${artist}" }`);
  });

  const result =
`AlbumA: [
${lines.join(",\n")}
]`;

  document.getElementById("output").value = result;
}

const bulkToggle = document.getElementById("bulkArtistToggle");
const bulkInput  = document.getElementById("bulkArtistInput");

// ãƒˆã‚°ãƒ«ON/OFF
bulkToggle.addEventListener("change", () => {
  bulkInput.disabled = !bulkToggle.checked;

  if (bulkToggle.checked) {
    applyBulkArtist();
  }
});

// ä¸€æ‹¬å…¥åŠ›æ¬„ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰å³åæ˜ 
bulkInput.addEventListener("input", applyBulkArtist);

function applyBulkArtist() {
  if (!bulkToggle.checked) return;

  const rows = document.querySelectorAll(".video-row");
  rows.forEach(row => {
    const artistInput = row.querySelectorAll("input")[1];
    if (!artistInput.value) {
      artistInput.value = bulkInput.value;
    }
  });
}

</script>

</body>
</html>
